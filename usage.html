<h1>what is apt-now</h1>

<p>Formerly called apt-git, apt-now is a static site generator which emits a Debian
repository which can be transferred to basically any http/s or similar site,
including things like Tor Hidden Services and i2p eepsites, but also static
hosting sites like github pages(You can even start by forking an existing
<a href="https://github.com/cmotc/apt-git/">repository</a> and cloning it, in the same
vein as jekyll-now's fork-first workflow). Right now it's default mode of
operation is to assume that you are using git to manage the uploading and
downloading of files. The plan is to eventually include many more ways of
transferring the data.</p>

<p>Oh, it's also pretty much all shell scripts and programs you should already have
installed. If you don't use markdown, start. It's great.</p>

<h2>How do I use apt-now</h2>

<p>Bear with me while I write the manuals, but it shouldn't take long, because as
you're about to see, it's really simple. First, you need to get a copy of the
system. You can do this by forking the apt-now <a href="https://github.com/cmotc/apt-git/">repository</a> and
cloning it.</p>

<pre><code>    git clone https://github.com/$YOUR_FORK/apt-git
</code></pre>

<p>BUT you'll still have the apt-now repository's public key in your copy if you
do it this way. No biggie, though just delete cmotc.github.io.gpg.key from your
copy and apt-now will automatically generate a new key for you next time you use
it.</p>

<p>apt-now also host's itself the site at <a href="https://cmotc.github.io/apt-now/">https://cmotc.github.io/apt-now/</a>
is a live copy of the repository hosting apt-now and pkpage(A script which
generates pages for each of the packages hosted in your apt-now instance) and
so is every fork of that repository and the clone on your computer. So if you
create a file like <strong>/etc/apt/sources.list.d/apt-now.list</strong> with the contents</p>

<pre><code>    deb https://cmotc.github.io/apt-git/debian rolling main
</code></pre>

<p>and tell your Package Manager to trust my key by running this command</p>

<pre><code>    wget -qO - https://cmotc.github.io/apt-git/cmotc.github.io.gpg.key | sudo apt-key add -
</code></pre>

<p>then you'll be able to run the following commands</p>

<pre><code>    sudo apt-get install apt-transport-https
    sudo apt-get update
    sudo apt-get install apt-now pkpage
</code></pre>

<p>and have a copy of apt-now installed on your system, managed by your package
manager, from a repository created by apt-now! Which is kinda cool. Now
unfortunately it's not <em>totally</em> zero-configuration yet. I'm working on it, some
things need to be a little bit better organized first to generate the
configuration file for you. But apt-now is intended to be pretty flexible to
configure, and you can do it by passing parameters to the program, or setting
environment variables, or by creating a configuration file which loads those
environment variables called aptgit.conf.</p>

<h3>Environment Variables</h3>

<p>The basis for all the configuration is a group of environment variables which
are read by the program. You can set them in your shell, via a config file, or
as parameters.</p>

<ul>
<li><strong>CURDIR=</strong> By default, apt-now will run from the directory where it's invoked.
If you want to change where it runs by default, you can set the CURDIR
environment variable.
<ul>
<li>example: "$HOME/Projects/apt-git"</li>
</ul></li>
<li><strong>ORIGIN=</strong> This is the URL of the site where you'll be hosting your repository.
It's used to generate the instructions for adding the repository to your
sources.list that will be automatically added to your home page. If left
blank, you'll need to modify your home page manually to add it or rely on
people figuring it out. IT IS ONLY used to generate these instructions. If you
don't care about the presence of the instructions, the repository will still
be usable.
<ul>
<li>example: "user.github.io"</li>
</ul></li>
<li><strong>REPONAME=</strong> This is the name you want to use for your repository. It will be
used to generate the headline for your repository's home page. It's not the
end of the world if it's left blank.
<ul>
<li>example: "apt-now"</li>
</ul></li>
<li><strong>REPODESC=</strong> This is the long description of the repository which will be used
generate the body of the repository home page. It can be left blank, too,
with basically no consequences.
<ul>
<li>example: "Repository for apt-now, a system for setting up apt repositories
on static hosts."</li>
</ul></li>
<li><strong>CODENAME=</strong> This can be any value you like, but I personally like to use
either testing, rolling, or unstable. It corresponds to the branch of the
repository where the packages will be made available.
<ul>
<li>example: "testing"</li>
</ul></li>
<li><strong>REPOARCH=</strong> This is a whitespace-separated list of the architectures that your
packages are intended to support.
<ul>
<li>example: "amd64 i386"</li>
</ul></li>
<li><strong>POLICY=</strong> This corresponds to the policy of the packages in the repository.
Officially, it can be main, contrib, or non-free but Ubuntu calls them
different things so it may be possible to assign them arbitrarily. Just
don't use "main" unless you're sure that your software is
Free-as-in-Freedom.
<ul>
<li>example: "main" "main contrib" "universe"</li>
</ul></li>
<li><strong>KEY=</strong> This is the ID of the key you want to use to sign the packages. If you
have a GPG key you want to use to sign the packages, you can set it here,
or if you create a new key with apt-now you will be prompted to enter it
interactively.
<ul>
<li>example: "554DB437"</li>
</ul></li>
<li><strong>START_HTTPD=</strong> This starts a static httpd in the repository
directory, serving the http server on port 45291(which spells "debia" and makes
it accessible on the LAN, or I guess mesh too, or whatever.
<ul>
<li>example: "YES"</li>
</ul></li>
<li><strong>OVERRIDE=</strong> This is the override settings for the repository. You probably
won't need to change this setting.
<ul>
<li>example: "override.testing"</li>
</ul></li>
</ul>

<h3>aptgit.conf is just a shell script</h3>

<p>These environment variables can also be set in a configuration file at the base
of your repository called aptgit.conf. This is an example aptgit.conf file for
the default apt-now repository.</p>

<pre><code>    #! /bin/sh
    #CURDIR=""
    ORIGIN="cmotc.github.io"
    REPONAME="apt-now"
    REPODESC="Repository for apt-now, a system for setting up apt
    repositories on static hosts."
    CODENAME="rolling"
    REPOARCH="amd64 i386 armhf"
    POLICY="main"
    KEY="554DB437"
    OVERRIDE="override.testing"
</code></pre>

<h3>Passing Parameters, I hope you hate this way.</h3>

<p>You can also set all the variables by passing them as parameters to the apt-now
program. This is all available in the output of apt-now --help. Personally, I
think this is by far the least convenient way of using it. Most of these don't
need to be passed at all after an interactive run unless you want to change
something though. I'll try to improve how this soon.</p>

<pre><code>    -d \ --directory\n
            Work in this directory, uses current directory by default\n
    -o \ --origin\n
            URL of the repository\n
    -c \ --codename\n
            Codename you want to use, defaults is \"testing\"\n
    -a \ --arch\n
            Architecture you want to host, defaults to \"all\"\n
    -p \ --policy\n
            Policy of packages you want to host, defaults to \"main\"\n
    -k \ --key\n
            ID of the package signing key\n
    -s \ --sources\n
            Folder with the packages to include in the repo\n
    -q \ --override\n
            Name of the override file\n
    -m \ --message\n
            Message to include in the commit\n
    -n \ --name\n
            Human-readable name of the Repository\n
    -v \ --desc\n
            Detailed repository description\n
    -c \ --check\n
            Make sure the dependencies are installed\n
    -r \ --reset\n
            Re-generate all components of the repository\n
    -u \ --user \ --org \ --organization\n
            Us as user/organization page, post page to master branch\n
    -h \ --help\n
            Display this help message\n
</code></pre>
